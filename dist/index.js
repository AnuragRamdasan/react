"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react");class q{constructor({appId:t,apiKey:n,customerApiToken:s,apiUrl:r="https://appapi.heymantle.com/v1"}){if(!t)throw new Error("MantleClient appId is required");if(typeof window<"u"&&n)throw new Error("MantleClient apiKey should never be used in the browser");if(!n&&!s)throw new Error("MantleClient one of apiKey or customerApiToken is required");this.appId=t,this.apiKey=n,this.customerApiToken=s,this.apiUrl=r}async mantleRequest({path:t,method:n="GET",body:s}){try{return await(await fetch(`${this.apiUrl}${t.startsWith("/")?"":"/"}${t}`,{method:n,headers:{"Content-Type":"application/json",Accept:"application/json","X-Mantle-App-Id":this.appId,...this.apiKey?{"X-Mantle-App-Api-Key":this.apiKey}:{},...this.customerApiToken?{"X-Mantle-Customer-Api-Token":this.customerApiToken}:{}},...s&&{body:JSON.stringify(s)}})).json()}catch(r){throw console.error(`[mantleRequest] ${t} error: ${r.message}`),r}}async identify({platformId:t,myshopifyDomain:n,platform:s="shopify",accessToken:r,name:a,email:c,customFields:y}){return await this.mantleRequest({path:"identify",method:"POST",body:{platformId:t,myshopifyDomain:n,platform:s,accessToken:r,name:a,email:c,customFields:y}})}async getCustomer(){return(await this.mantleRequest({path:"customer"})).customer}async subscribe({planId:t,planIds:n,discountId:s,returnUrl:r,billingProvider:a}){return await this.mantleRequest({path:"subscriptions",method:"POST",body:{planId:t,planIds:n,discountId:s,returnUrl:r,billingProvider:a}})}async cancelSubscription({cancelReason:t}={}){return await this.mantleRequest({path:"subscriptions",method:"DELETE",...t&&{body:{cancelReason:t}}})}async updateSubscription({id:t,cappedAmount:n}){return await this.mantleRequest({path:"subscriptions",method:"PUT",body:{id:t,cappedAmount:n}})}async sendUsageEvent({eventId:t,eventName:n,customerId:s,properties:r={}}){return await this.mantleRequest({path:"usage_events",method:"POST",body:{eventId:t,eventName:n,...s?{customerId:s}:{},properties:r}})}async sendUsageEvents({events:t}){return await this.mantleRequest({path:"usage_events",method:"POST",body:{events:t}})}}var R={MantleClient:q};const b=l.createContext(),F=({feature:e,count:t=0})=>(e==null?void 0:e.type)==="boolean"?e.value:(e==null?void 0:e.type)==="limit"?t<e.value||e.value===-1:!1,U=({appId:e,customerApiToken:t,apiUrl:n="https://appapi.heymantle.com/v1",children:s})=>{const r=new R.MantleClient({appId:e,customerApiToken:t,apiUrl:n}),[a,c]=l.useState(null),[y,p]=l.useState(!0),[P,f]=l.useState(null),m=async()=>{try{p(!0);const o=await r.getCustomer();c(o)}catch(o){f(o)}finally{p(!1)}},E=async o=>{await r.sendUsageEvent(o)},g=async({planId:o,planIds:d,discountId:A,billingProvider:T,returnUrl:D})=>await r.subscribe({planId:o,planIds:d,discountId:A,billingProvider:T,returnUrl:D}),C=async()=>await r.cancelSubscription();l.useEffect(()=>{t&&m()},[t]);const M=(a==null?void 0:a.plans)||[],u=a==null?void 0:a.subscription,L=u==null?void 0:u.plan;return l.createElement(b.Provider,{value:{customer:a,subscription:u,plans:M,loading:y,error:P,mantleClient:r,sendUsageEvent:E,subscribe:g,cancelSubscription:C,isFeatureEnabled:({featureKey:o,count:d=0})=>a!=null&&a.features[o]?F({feature:a.features[o],count:d}):!1,limitForFeature:({featureKey:o})=>a!=null&&a.features[o]&&L.features[o].type==="limit"?a.features[o].value:-1,refetch:async()=>{await m()}}},s)},O=()=>{const e=l.useContext(b);if(e===void 0)throw new Error("useMantle must be used within a MantleProvider");return e},h=e=>e.type==="boolean"&&e.value==!0||e.type==="limit"&&e.value!==0,Y=(e,t)=>h(t)-h(e)||e.name.localeCompare(t.name),$=(e="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:e,notation:"standard"}),k=(e,t="USD",n=!0)=>{let s=$(t).format(e);return n&&(s=s.replace(/\.00$/,"")),s},i={Annual:"ANNUAL",Every30Days:"EVERY_30_DAYS"},B={Public:"public",CustomerTag:"customerTag",ShopifyPlan:"shopifyPlan",Customer:"customer",Hidden:"hidden"},v={Back:"Back",CurrentPlan:"Current plan",CustomPlans:"Custom plans",CustomPlansDescription:"Plans tailored to your specific needs",FreeTrialLength:"{{ trialDays }}-day free trial",Features:"Features",Month:"month",MonthShort:"mo",Monthly:"Monthly",Year:"year",YearShort:"yr",Yearly:"Yearly",MostPopular:"Most popular",Per:"/",Plans:"Plans",SelectPlan:"Select plan",SubscribeSuccessTitle:"Subscription successful",SubscribeSuccessBody:"Thanks for subscribing to our app!"},S=(e=i.Every30Days)=>{switch(e){case i.Annual:return"year";case i.Every30Days:default:return"month"}},w=(e=i.Every30Days)=>{switch(e){case i.Annual:return"yr";case i.Every30Days:default:return"mo"}},I=({interval:e=i.Every30Days,useShortFormPlanIntervals:t=!0})=>t?w(e):S(e),j=({plan:e,customFieldKey:t="recommended"})=>{var n;return!!((n=e.customFields)!=null&&n[t])},x=({plan:e,customFieldKey:t="buttonLabel"})=>{var n;return((n=e.customFields)==null?void 0:n[t])||v.SelectPlan},N=({plan:e})=>{var t;return((t=e.discounts)==null?void 0:t.length)>0?e.discounts.reduce((n,s)=>n.discountedAmount<s.discountedAmount?n:s):void 0};exports.Labels=v;exports.MantleProvider=U;exports.PlanAvailability=B;exports.PlanInterval=i;exports.customButtonLabel=x;exports.featureEnabled=h;exports.featureSort=Y;exports.highestDiscount=N;exports.intervalLabel=I;exports.intervalLabelLong=S;exports.intervalLabelShort=w;exports.isRecommendedPlan=j;exports.money=k;exports.useMantle=O;
