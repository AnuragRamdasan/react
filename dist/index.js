"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const m=require("react");class F{constructor({appId:t,apiKey:n,customerApiToken:s,apiUrl:o="https://appapi.heymantle.com/v1"}){if(!t)throw new Error("MantleClient appId is required");if(typeof window<"u"&&n)throw new Error("MantleClient apiKey should never be used in the browser");this.appId=t,this.apiKey=n,this.customerApiToken=s,this.apiUrl=o}async mantleRequest({path:t,method:n="GET",body:s}){try{const o=`${this.apiUrl}${t.startsWith("/")?"":"/"}${t}${s&&n==="GET"?`?${new URLSearchParams(s)}`:""}`;return await(await fetch(o,{method:n,headers:{"Content-Type":"application/json",Accept:"application/json","X-Mantle-App-Id":this.appId,...this.apiKey?{"X-Mantle-App-Api-Key":this.apiKey}:{},...this.customerApiToken?{"X-Mantle-Customer-Api-Token":this.customerApiToken}:{}},...s&&n!=="GET"&&{body:JSON.stringify(s)}})).json()}catch(o){throw console.error(`[mantleRequest] ${t} error: ${o.message}`),o}}async identify({platformId:t,myshopifyDomain:n,platform:s="shopify",accessToken:o,name:l,email:d,customFields:i,createdAt:r,rotateApiToken:S,tags:p,operators:y,address:h}){return await this.mantleRequest({path:"identify",method:"POST",body:{platformId:t,myshopifyDomain:n,platform:s,accessToken:o,name:l,email:d,customFields:i,createdAt:r,rotateApiToken:S,tags:p,operators:y,address:h}})}async getCustomer(t){return(await this.mantleRequest({path:"customer",...t?{body:{id:t}}:{}})).customer}async subscribe({planId:t,planIds:n,discountId:s,returnUrl:o,billingProvider:l,useSavedPaymentMethod:d=!1}){return await this.mantleRequest({path:"subscriptions",method:"POST",body:{planId:t,planIds:n,discountId:s,returnUrl:o,billingProvider:l,useSavedPaymentMethod:d}})}async cancelSubscription({cancelReason:t}={}){return await this.mantleRequest({path:"subscriptions",method:"DELETE",...t&&{body:{cancelReason:t}}})}async updateSubscription({id:t,cappedAmount:n}){return await this.mantleRequest({path:"subscriptions",method:"PUT",body:{id:t,cappedAmount:n}})}async sendUsageEvent({eventId:t,eventName:n,timestamp:s,customerId:o,properties:l={}}){return await this.mantleRequest({path:"usage_events",method:"POST",body:{eventId:t,eventName:n,timestamp:s,...o?{customerId:o}:{},properties:l}})}async sendUsageEvents({events:t}){return await this.mantleRequest({path:"usage_events",method:"POST",body:{events:t}})}async addPaymentMethod({returnUrl:t}){return await this.mantleRequest({path:"payment_methods",method:"POST",...t&&{body:{returnUrl:t}}})}async getUsageMetricReport({id:t,period:n,customerId:s}){return await this.mantleRequest({path:`usage_events/${t}/report`,body:{...n?{period:n}:{},...s?{customerId:s}:{}}})}async createHostedSession(t){const{type:n,config:s}=t;return(await this.mantleRequest({path:"hosted_sessions",method:"POST",body:{type:n,config:s}})).session}}const $={finalize:"finalize",setup:"setup",subscribe:"subscribe"};var O={MantleClient:F,SubscriptionConfirmType:$};const c={Annual:"ANNUAL",Every30Days:"EVERY_30_DAYS"},N={Public:"public",CustomerTag:"customerTag",ShopifyPlan:"shopifyPlan",Customer:"customer",Hidden:"hidden"},g={AmountPerInterval:"{{ amount }} per {{ interval }}",Back:"Back",Cancel:"Cancel",CancelConfirmation:"Are you sure you want to cancel your subscription?",CancelPlan:"Cancel plan",ChangePlan:"Change plan",CurrentPlan:"Current plan",CustomPlans:"Custom plans",CustomPlansDescription:"Plans tailored to your specific needs",DiscountAmount:"{{ amount }} discount",DiscountAmountExpired:"{{ amount }} discount expired",FreeTrialLength:"{{ trialDays }}-day free trial",Features:"Features",Month:"month",MonthShort:"mo",Monthly:"Monthly",NextBillingDate:"Next billing date",NotSubscribed:"You're not subscribed to a plan yet.",Year:"year",YearShort:"yr",Yearly:"Yearly",MostPopular:"Most popular",Per:"/",Plans:"Plans",Price:"Price",SelectPlan:"Select plan",SubscribeSuccessTitle:"Subscription successful",SubscribeSuccessBody:"Thanks for subscribing to our app!",Subscription:"Subscription",SubscriptionCancelled:"Subscription cancelled",UsageCharges:"Usage charges"},v=m.createContext(),Y=({feature:e,count:t=0})=>(e==null?void 0:e.type)==="boolean"?e.value:(e==null?void 0:e.type)==="limit"?t<e.value||e.value===-1:!1,_=({appId:e,customerApiToken:t,apiUrl:n="https://appapi.heymantle.com/v1",children:s,i18n:o=g,waitForCustomer:l=!1,loadingComponent:d=null})=>{const i=new O.MantleClient({appId:e,customerApiToken:t,apiUrl:n}),[r,S]=m.useState(null),[p,y]=m.useState(!0),h=async()=>{try{y(!0);const a=await i.getCustomer();S(a)}catch(a){console.error("[MantleProvider] Error fetching customer: ",a)}finally{y(!1)}},E=async a=>{await i.sendUsageEvent(a)},M=async({usageId:a,period:u})=>await i.getUsageMetricReport({id:a,period:u}),T=async({planId:a,planIds:u,discountId:P,billingProvider:b,returnUrl:U,useSavedPaymentMethod:q=!1})=>await i.subscribe({planId:a,planIds:u,discountId:P,billingProvider:b,returnUrl:U,useSavedPaymentMethod:q}),A=async({cancelReason:a}={})=>await i.cancelSubscription({...a&&{cancelReason:a}}),L=async({returnUrl:a})=>await i.addPaymentMethod({returnUrl:a}),R=async({type:a,config:u})=>{const b=new URL(document.location.toString()).searchParams.get("locale");return await i.createHostedSession({type:a,config:{...b?{locale:b}:{},...u||{}}})};m.useEffect(()=>{t&&h()},[t]);const x=(r==null?void 0:r.plans)||[],D=r==null?void 0:r.subscription;return l&&p?d||"":m.createElement(v.Provider,{value:{customer:r,subscription:D,plans:x,loading:p,i18n:{...g,...o},sendUsageEvent:E,getUsageReport:M,subscribe:T,cancelSubscription:A,addPaymentMethod:L,createHostedSession:R,isFeatureEnabled:({featureKey:a,count:u=0})=>r!=null&&r.features[a]?Y({feature:r.features[a],count:u}):!1,limitForFeature:({featureKey:a})=>r!=null&&r.features[a]&&currentPlan.features[a].type==="limit"?r.features[a].value:-1,refetch:async()=>{await h()}}},s)},B=()=>{const e=m.useContext(v);if(e===void 0)throw new Error("useMantle must be used within a MantleProvider");return e},f=e=>e.type==="boolean"&&e.value==!0||e.type==="limit"&&e.value!==0,k=(e,t)=>f(t)-f(e)||e.name.localeCompare(t.name),I=(e="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:e,notation:"standard"}),j=(e,t="USD",n=!0)=>{let s=I(t).format(e);return n&&(s=s.replace(/\.00$/,"")),s},w=(e=c.Every30Days)=>{switch(e){case c.Annual:return"year";case c.Every30Days:default:return"month"}},C=(e=c.Every30Days)=>{switch(e){case c.Annual:return"yr";case c.Every30Days:default:return"mo"}},H=({interval:e=c.Every30Days,useShortFormPlanIntervals:t=!0})=>t?C(e):w(e),G=({plan:e,customFieldKey:t="recommended"})=>{var n;return!!((n=e.customFields)!=null&&n[t])},X=({plan:e,customFieldKey:t="buttonLabel"})=>{var n;return((n=e.customFields)==null?void 0:n[t])||g.SelectPlan},J=({plan:e})=>{var t;return((t=e.discounts)==null?void 0:t.length)>0?e.discounts.reduce((n,s)=>n.discountedAmount<s.discountedAmount?n:s):void 0},K=(e=4)=>e%4===0?{xs:6,sm:6,md:2,lg:3,xl:3}:e%3===0?{xs:6,sm:6,md:2,lg:4,xl:4}:e%2===0?{xs:6,sm:6,md:3,lg:6,xl:6}:e===1?{xs:6,sm:6,md:6,lg:12,xl:12}:{xs:6,sm:6,md:2,lg:4,xl:4},V=(e=4)=>e%4===0?4:e%3===0?3:e%2===0?2:e===1?1:4;exports.Labels=g;exports.MantleProvider=_;exports.PlanAvailability=N;exports.PlanInterval=c;exports.columnCount=V;exports.columnSpan=K;exports.customButtonLabel=X;exports.featureEnabled=f;exports.featureSort=k;exports.highestDiscount=J;exports.intervalLabel=H;exports.intervalLabelLong=w;exports.intervalLabelShort=C;exports.isRecommendedPlan=G;exports.money=j;exports.useMantle=B;
